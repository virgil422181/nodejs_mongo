/*!
 * eMAG Apps UI KIT v1.0.0 * Copyright 2001-2018 eMAG HX Team
 * Licensed under the ISC license
 */
!function(a,b){"use strict";if(!a.ui.HierarchicalSelect){var c={create:function(){return function(){this.initialize.apply(this,arguments)}}},d=c.create();d.prototype={_errorMessages:{rootStructureIncorrect:'Hierarchical Select Error: Data structure for root select group is incorrect. Please use as data something like: \n{\n\t0: [\n\t\t{\n\t\t\tkey: 97,\n\t\t\ttitle: "Air Conditioners",\n\t\t\tfolder: true,\n\t\t\tselected: false\n\t\t},\n\t\t{\n\t\t\tkey: 531,\n\t\t\ttitle: "Conditioning",\n\t\t\tfolder: false,\n\t\t\tselected: false\n\t\t}\n\t]\n}\n',ajaxRouteEmpty:"Hierarchical Select Error: AJAX route is not set."},initialize:function(a){var b=this;b._initWidgetOptions(a),b._initHtml(),b._initSliderVariables(),b._initConstants(),b._initSelectGroups(),b._initEvents()},_initWidgetOptions:function(b){return this.$widget=b,this.options=b.options,this.element=b.element,this.$select=a(b.options.select),this._selectedOptionsInSelectGroups=[],this.searchPlaceholder=this.options.searchPlaceholder,this.displayedSelects=this.options.displayedSelects||[0],this.data=this.options.data||null,this._hasDataStructure(this.data[0])?(this.ajaxRoute=this.options.ajaxRoute||"",""==this.ajaxRoute?(console.error(this._errorMessages.ajaxRouteEmpty),!1):void 0):(console.error(this._errorMessages.rootStructureIncorrect),!1)},_initHtml:function(){this.element.addClass("hierarchical").html('<button type="button" class="controls prev disabled fa fa-chevron-left"></button><button type="button" class="controls next disabled fa fa-chevron-right"></button><div class="row hierarchical-overflow-container"><div class="hierarchical-items-container"></div></div>'),this.$btnNext=this.element.find(".next"),this.$btnPrev=this.element.find(".prev"),this.$overflowContainer=this.element.find(".hierarchical-overflow-container"),this.$containerItems=this.element.find(".hierarchical-items-container")},_initSliderVariables:function(){this.currentPos=0,this.outsideLeftPosition=0,this.currentMaxVisibleItems=0,this.itemWidth=0,this.itemOuterWidth=0,this.visibleRemainingWidthOfItem=0},_initConstants:function(){this.ANIMATE_TIME=100,this.MOUSE_UP_DELAY=150,this.TAB_KEY_CODE=9,this.LEFT_ARROW_KEY_CODE=37,this.RIGHT_ARROW_KEY_CODE=39},_initSelectGroups:function(){var b=this,c=0;a.each(b.displayedSelects,function(a,d){b._newSelectGroup(c,b.data[d]),c++})},_initEvents:function(){var c=this;c.$btnNext.on("click",function(){c._next()}),c.$btnPrev.on("click",function(){c._prev()}),c.$overflowContainer.on("scroll",function(){c._onScroll()}).on("mousedown",function(a){if(2==a.which)return a.preventDefault(),a.stopPropagation(),!1}),a(document).on("keydown keypress keyup",function(b){a.inArray(b.which,[c.TAB_KEY_CODE,c.LEFT_ARROW_KEY_CODE,c.RIGHT_ARROW_KEY_CODE])!==-1&&setTimeout(function(){c._onMouseUp()},c.MOUSE_UP_DELAY)}),c.element.parents(".widget-box").find('a[data-action="collapse"]').on("click",function(){setTimeout(function(){c._updateWidths()},c.MOUSE_UP_DELAY)}),a(b).resize(function(){c._updateWidths()})},_newSelectGroup:function(a,b){var c=this._createSelectGroup(a,b);this._addSelectGroupEvents(c,b),this.$containerItems.append(c),this._isFirstSelectGroup()&&(this.$firstSelectGroup=this.$containerItems.find(".hierarchical-select-group").eq(0)),this._unblockAllSelectGroups(),this.currentPos=this._getNoOfExistingGroups(),this._updateWidths(),this.$btnNext.addClass("disabled"),this._animateAction("append")},_createSelectGroup:function(b,c){var d=this,e=a('<div class="hierarchical-select-group col-xs-12 col-sm-6 col-md-4 col-lg-3"><div class="hierarchical-select-group-search-container"><input type="text" class="hierarchical-select-group-search form-control" placeholder="'+this.searchPlaceholder+'"><span class="fa fa-search form-control-feedback" aria-hidden="true"></span></div><select data-key="'+b+'" size="6" class="hierarchical-select-group-select form-control"></select></div>'),f=e.find(".hierarchical-select-group-select");return a.each(c,function(a,b){d._createSelectOption(f,b.key,b.title,b.selected,b.folder)}),a(e)},_addSelectGroupEvents:function(a,b){var c=a.find(".hierarchical-select-group-search"),d=a.find(".hierarchical-select-group-select");this._filterByText(c,d,b),this._selectGroupSelect(d)},_filterByText:function(b,c,d){b.on("input change keyup",function(){var b=a.trim(a(this).val()),d=new RegExp(b,"gi");c.find("option").each(function(b,c){null!==a(c).text().match(d)?a(c).removeClass("hidden").removeAttr("disabled"):a(c).addClass("hidden").attr("disabled","disabled")})})},_selectGroupSelect:function(b){var c=this;b.on("change",function(){var d=a(this),e=c._getSelectGroupKey(b),f=d.val();c._blockAllSelectGroups(),c._saveSelectSelection(e,f),c._removeFollowingSelectGroups(e),c._loadChildrenForSelection(d,f)}).on("keydown keypress keyup",function(b){if(a.inArray(b.which,[c.LEFT_ARROW_KEY_CODE,c.RIGHT_ARROW_KEY_CODE])!==-1)return b.preventDefault(),b.stopPropagation(),!1})},_createSelectOption:function(a,b,c,d,e){d=d?'selected="selected"':"",e=e||!1,a.append('<option value="'+b+'"'+d+' data-folder="'+e+'">'+c+"</option>")},_saveSelectSelection:function(a,b){this._selectedOptionsInSelectGroups[a]=b,this.$select.find("option").removeAttr("selected"),0==this.$select.find('option[value="'+b+'"]').length?this._createSelectOption(this.$select,b,"",!0,!1):this.$select.val(b)},_removeFollowingSelectGroups:function(a){for(this._cleanSelectedOptionsInSelectGroups(a);this._isNotLastSelectGroup(a);)this._removeLastSelectGroup()},_loadChildrenForSelection:function(b,c){var d=this;if(this._categoryHasChildren(b,c)){var e=this._getNoOfExistingGroups();this._categoryChildrenAreLoaded(c)?this._newSelectGroup(e,this.data[c]):a.get(this.ajaxRoute,{key:c},function(b){d.data[c]=[],a.each(b,function(a,b){d.data[c].push({key:b.key,title:b.title,folder:!!b.folder&&b.folder,selected:!!b.selected&&b.selected})}),d._newSelectGroup(e,d.data[c])},"json")}else this._unblockAllSelectGroups(b)},_updateWidths:function(){this._resetWidths(),this._calculateNewWidths(),this._setNewWidths(),this._setCurrentPosAfterResize(),this._setButtonsState(),this._animateAction("resize")},_resetWidths:function(){var b=this.$containerItems.find(".hierarchical-select-group");this.$containerItems.css({width:"",left:""}),a.each(b,function(b,c){a(this).css({width:""})})},_calculateNewWidths:function(){this.itemWidth=this.$firstSelectGroup.width()-1,this.itemOuterWidth=this.$firstSelectGroup.outerWidth()-1,this.currentMaxVisibleItems=Math.floor(this.$overflowContainer.width()/this.itemWidth)},_setNewWidths:function(){var b=this,c=b.$containerItems.find(".hierarchical-select-group");a.each(c,function(){a(this).width(b.itemWidth)}),b.$containerItems.width(b._getNoOfExistingGroups()*this.itemOuterWidth),b.visibleRemainingWidthOfItem=0,b.isScrolling=!1},_onScroll:function(){var a=this;a.isScrolling||(a.isScrolling=!0,a.$overflowContainer.off("mouseup"),a.$overflowContainer.on("mouseup",function(b){setTimeout(function(){a._onMouseUp()},a.MOUSE_UP_DELAY)}))},_animateAction:function(a){var b=Math.max(0,(this.currentPos-this.currentMaxVisibleItems)*this.itemOuterWidth);switch(a){case"append":this.$containerItems.parent().scrollLeft(b-this.itemOuterWidth),this.$containerItems.parent().stop().animate({scrollLeft:b},this.ANIMATE_TIME);break;case"removeLast":this.$containerItems.parent().scrollLeft(b);break;case"next":case"prev":this.$containerItems.parent().stop().animate({scrollLeft:b},this.ANIMATE_TIME);break;case"resize":this.$containerItems.parent().scrollLeft(b)}},_setCurrentPosAfterResize:function(){var a=this._getNoOfExistingGroups();a>=this.currentMaxVisibleItems?0!==this.visibleRemainingWidthOfItem?this.currentPos=Math.max(this.currentPos+1,this.currentMaxVisibleItems):this.currentPos=Math.max(this.currentPos,this.currentMaxVisibleItems):this.currentPos=a},_setButtonsState:function(){var a=this,b=a._getNoOfExistingGroups();setTimeout(function(){a.currentPos>=b?a.$btnNext.addClass("disabled"):a.$btnNext.removeClass("disabled"),b<=a.currentMaxVisibleItems||0==a.$containerItems.parent().scrollLeft()?a.$btnPrev.addClass("disabled"):a.$btnPrev.removeClass("disabled")},a.MOUSE_UP_DELAY)},_next:function(){if(0!==this.visibleRemainingWidthOfItem){var a=this.$containerItems.parent().scrollLeft()+this.visibleRemainingWidthOfItem;this.visibleRemainingWidthOfItem=0,this._setCurrentPosToNextFullyViewedItem(a)}else this.currentPos=Math.min(this._getNoOfExistingGroups(),this.currentPos+1);this._setButtonsState(),this._animateAction("next")},_setCurrentPosToNextFullyViewedItem:function(a){this.currentPos=Math.min(Math.floor(a/this.itemOuterWidth)+this.currentMaxVisibleItems,this._getNoOfExistingGroups())},_prev:function(){var a=this.$containerItems.parent().scrollLeft()-(this.itemOuterWidth-this.visibleRemainingWidthOfItem);this.visibleRemainingWidthOfItem=0,this._setCurrentPosToPreviousFullyViewedItem(a),this._setButtonsState(),this._animateAction("prev")},_setCurrentPosToPreviousFullyViewedItem:function(a){this.currentPos=Math.round(a/this.itemOuterWidth)+this.currentMaxVisibleItems},_onMouseUp:function(){var a=this._getNoOfExistingGroups();if(this.outsideLeftPosition=this.$containerItems.parent().scrollLeft(),this.visibleRemainingWidthOfItem=this.itemOuterWidth-this.outsideLeftPosition%this.itemOuterWidth,this.visibleRemainingWidthOfItem==this.itemOuterWidth&&(this.visibleRemainingWidthOfItem=0),this.outsideLeftPosition>0){var b=this._getNoOfItemsNotVisible();this.currentPos=Math.min(b+this.currentMaxVisibleItems,a)}else this.currentPos=this.currentMaxVisibleItems;this.isScrolling=!0,this._setButtonsState()},_getNoOfItemsNotVisible:function(){return Math.round(this.outsideLeftPosition/this.itemOuterWidth)},_isFirstSelectGroup:function(){return 1==this._getNoOfExistingGroups()},_getSelectGroupKey:function(a){return parseInt(a.attr("data-key"))},_isGroupKeyOption:function(a,b){return this._selectedOptionsInSelectGroups[a]==b},_hasDataStructure:function(a){return a instanceof Array&&a.length>0},_getNoOfExistingGroups:function(){return this.element.find(".hierarchical-select-group").length},_cleanSelectedOptionsInSelectGroups:function(a){this._selectedOptionsInSelectGroups.splice(a+1,this._selectedOptionsInSelectGroups.length)},_isNotLastSelectGroup:function(a){var b=this._getNoOfExistingGroups();return b>a+1},_removeLastSelectGroup:function(){this.$overflowContainer.off("mouseup"),this.element.find(".hierarchical-select-group:last").remove(),this.currentPos=this._getNoOfExistingGroups(),this._updateWidths(),this._animateAction("removeLast")},_categoryHasChildren:function(a,b){return"true"==a.find('option[value="'+b+'"]').attr("data-folder")},_categoryChildrenAreLoaded:function(a){return this.data[a]&&this._hasDataStructure(this.data[a])},_blockAllSelectGroups:function(){this.element.find("select").blur().css("overflow-y","hidden"),this.element.find("input, select").attr("disabled","disabled"),this.$overflowContainer.blockControl()},_unblockAllSelectGroups:function(a){if(this.element.find("select").css("overflow-y","scroll").blur(),this.element.find("input, select").removeAttr("disabled"),this.$overflowContainer.unblockControl(),a)a.focus();else{var b=this._getNoOfExistingGroups();this.element.find("select").eq(b-2).focus()}}},a.widget("ui.HierarchicalSelect",{options:{searchPlaceholder:"Search",select:"",data:null,displayedSelects:[0],ajaxRoute:""},_create:function(){this.HierarchicalSelect=new d(this)}})}}(jQuery,window);